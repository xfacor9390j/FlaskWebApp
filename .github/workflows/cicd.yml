deploy:
  runs-on: ubuntu-latest
  needs: build

  steps:
  - name: Checkout repository
    uses: actions/checkout@v3

  - name: Log in to Docker Hub
    uses: docker/login-action@v2
    with:
      username: ${{ secrets.DOCKER_USERNAME }}
      password: ${{ secrets.DOCKER_PASSWORD }}

  - name: Build & Push Docker Image
    uses: docker/build-push-action@v4
    with:
      context: .
      push: true
      tags: ${{ secrets.DOCKER_USERNAME }}/devops:${{ github.sha }}

  - name: Deploy to Azure Web App
    uses: azure/webapps-deploy@v2
    with:
      app-name: 'devopsepita'
      publish-profile: ${{ secrets.AZURE_WEBAPP_PUBLISH_PROFILE }}
      images: '${{ secrets.DOCKER_USERNAME }}/devops:${{ github.sha }}'